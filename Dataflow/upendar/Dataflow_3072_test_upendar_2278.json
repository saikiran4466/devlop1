{"dataflow":{"dfKey":"8d6221f2-d071-4416-bcf0-6c296533b301","name":"Dataflow_3072_test_upendar_2278","tags":null,"description":null,"definition":"{\"name\":\"Dataflow_3072_test_upendar_2278\",\"version\":0,\"livyServerId\":0,\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"print(spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getPasswordFromWallet(\\\"upendar1\\\"))\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":1,\"componentName\":\"Code 1\",\"tableName\":\"code_1\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"url\":\"https://qa69.datagapsinc.in:8443/DataFlowService/api/v1.0/dataFlows/executeDataFlow\",\"requestType\":\"POST\",\"headers\":[{\"key\":\"Accept\",\"value\":\"*/*\"},{\"key\":\"Accept-Encoding\",\"value\":\"gzip, deflate, br\"},{\"key\":\"Content-Type\",\"value\":\"application/json\"}],\"authorization\":{\"isVariable\":\"Y\",\"type\":\"Bearer Token\",\"token\":\"token2\"},\"body\":\"\",\"params\":[{\"key\":\"dataflowId\",\"value\":\"#[upendar2]\"}],\"preRequestScript\":\"import requests\\r\\nurl \\u003d \\\"https://qa69.datagapsinc.in:8443/dataopssecurity/oauth2/token\\\"\\r\\npayload\\u003d{\\u0027grant_type\\u0027: \\u0027password\\u0027,\\r\\n\\u0027username\\u0027: \\u0027dataops-sa\\u0027,\\r\\n\\u0027password\\u0027: \\u0027U2FsdGVkX1/XJHHtsQJWjIaSjBGVuPrFAtzC4OKE9Y0\\u003d\\u0027}\\r\\nfiles\\u003d[]\\r\\nheaders \\u003d {\\r\\n  \\u0027Content-Type\\u0027: \\u0027application/x-www-form-urlencoded\\u0027,\\r\\n  \\u0027Authorization\\u0027: \\u0027Basic ZGF0YW9wc3N1aXRlLWNsaS1jbGllbnQ6c3ByaW5nLXNlY3VyaXR5LW9hdXRoMi1yZWFkLXdyaXRlLWNsaWVudC1wYXNzd29yZDEyMzQ\\u003d\\u0027\\r\\n}\\r\\n\\r\\nresponse \\u003d requests.request(\\\"POST\\\", url, headers\\u003dheaders, data\\u003dpayload, files\\u003dfiles,verify\\u003dFalse)\\r\\n\\r\\npre_script_variables[\\\"token2\\\"]\\u003dresponse.json()[\\u0027access_token\\u0027]\\r\\n\",\"baseUrl\":\"https://qa69.datagapsinc.in:8443/DataFlowService/api/v1.0/\",\"endPoint\":\"dataFlows/executeDataFlow\",\"componentId\":2,\"componentName\":\"API 2\",\"tableName\":\"API_2\",\"category\":\"Source\",\"componentType\":\"API\",\"rank\":0,\"dataSourceName\":\"APIprequest_df_dbflows_upendar\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.APIComponent\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"from datagaps_utilities import config\\nimport psycopg2\\n\\nprint(config.root_folder)\\nprint(config.DB_HOST)\\nprint(config.DB_NAME)\\nprint(config.DB_USER)\\nprint(config.DB_PASSWORD)\\nprint(config.DB_PORT)\\n\\n\\nprint(config.browser_location)\\nprint(config.configs.get(\\\"browser_location\\\"))\\nprint(config.configs.get(\\\"abc\\\"))\\n\\ndb_connection \\u003d psycopg2.connect(\\n    host\\u003dconfig.DB_HOST,\\n    database\\u003dconfig.DB_NAME,\\n    user\\u003dconfig.DB_USER,\\n    password\\u003dconfig.DB_PASSWORD,\\n    port\\u003dconfig.DB_PORT\\n)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":4,\"componentName\":\"Code 4\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"k\\u003dspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getConnectionParams(\\\"EXCEL_upendar_adls\\\",\\\"read\\\")\\n\\nprint(type(k))\\nprint(k)\\n\\nconn\\u003d[k.toList().apply(i) for i in range(k.size())]\\nconn_details\\u003d {i._1(): i._2() for i in conn}\\n\\nprint(conn)\\nprint(conn_details)\\n\\n\\nprint(spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getDecryptedPassword(conn_details[\\\"access-key\\\"]))\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":5,\"componentName\":\"Code 5\",\"tableName\":\"code_5\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"k\\u003dspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getConnectionParams(\\\"EXCEL aws s3 upendar\\\",\\\"read\\\")\\n\\nprint(type(k))\\nprint(k)\\n\\nconn\\u003d[k.toList().apply(i) for i in range(k.size())]\\nconn_details\\u003d {i._1(): i._2() for i in conn}\\n\\nprint(conn)\\nprint(conn_details)\\n\\n\\n# print(spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getDecryptedPassword(conn_details[\\\"access-key\\\"]))\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":6,\"componentName\":\"Code 6\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"workSheets\":[{\"name\":\"Flight Delays\",\"datasetName\":\"Flight_Delays\"}],\"reportViewPath\":\"Regional_MainFolder/FlightDelays\",\"filters\":[],\"parameters\":[],\"viewType\":\"worksheet\",\"viewTitle\":\"Workbook: Regional_Main Folder\",\"componentId\":9,\"componentName\":\"Tableau 9\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Tableau\",\"rank\":0,\"dataSourceName\":\"upendar_tableau_dgvm781\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.BIComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"workSheets\":[{\"name\":\"S\\u0026P Forward Returns\",\"datasetName\":\"S_P_Forward_Returns\"}],\"reportViewPath\":\"Regional_16578700410810/Economy\",\"filters\":[],\"parameters\":[],\"viewType\":\"dashboard\",\"viewTitle\":\"Workbook: Regional\",\"componentId\":10,\"componentName\":\"Tableau 10\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Tableau\",\"rank\":0,\"dataSourceName\":\"tabluea2\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.BIComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"workSheets\":[{\"name\":\"S\\u0026P Forward Returns\",\"datasetName\":\"S_P_Forward_Returns_1\"},{\"name\":\"S\\u0026P Returns by Decade\",\"datasetName\":\"S_P_Returns_by_Decade_1\"},{\"name\":\"S\\u0026P Returns Vs Conditions\",\"datasetName\":\"S_P_Returns_Vs_Conditions_1\"}],\"reportViewPath\":\"Regional-1/Economy\",\"filters\":[],\"parameters\":[],\"marks\":[{\"sheetName\":\"S\\u0026P Forward Returns\",\"markPairs\":[{\"name\":\"Decade\",\"value\":\"1970\"},{\"name\":\"Metric\",\"value\":\"1 Year\"},{\"name\":\"Value\",\"value\":\"-28%\"},{\"name\":\"YEAR(Date)\",\"value\":\"1973\"}]},{\"sheetName\":\"S\\u0026P Returns by Decade\",\"markPairs\":[{\"name\":\"AVG(Value)\",\"value\":\"9%\"},{\"name\":\"Decade\",\"value\":\"1950\"},{\"name\":\"Metric\",\"value\":\"Inflation rate\"},{\"name\":\"YEAR(Date)\",\"value\":\"1951\"}]}],\"viewType\":\"dashboard\",\"viewTitle\":\"Workbook: Regional-1\",\"componentId\":12,\"componentName\":\"Tableau 12\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Tableau\",\"rank\":0,\"dataSourceName\":\"tabluea2\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.BIComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"import json\\r\\nimport pandas as pd\\r\\nfrom io import StringIO\\r\\n\\r\\n\\r\\ndef csv_to_list(csv_string):\\r\\n    df \\u003d pd.read_csv(StringIO(csv_string), keep_default_na\\u003dFalse, na_values\\u003d[\\\"\\\"])\\r\\n\\r\\n    print(df[[\\\"Daily report viewers\\\",\\\"Weekly Viewers\\\"]].head())\\r\\n    # df.fill_na(null)\\r\\n    d \\u003d df.to_dict(orient\\u003d\\\"records\\\")\\r\\n    # print(d)\\r\\n    return d\\r\\n    \\r\\na\\u003d{\\\"b0c4064800d732c409ca\\\":\\\"Daily report viewers,Weekly Viewers,Report views\\\\r\\\\n1,,1\\\\r\\\\n\\\"}\\r\\n\\r\\nprint(a)\\r\\n\\r\\npower_bi_data \\u003d {k: csv_to_list(v) for k, v in a.items()}\\r\\n\\r\\nprint(power_bi_data)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":13,\"componentName\":\"Code 13\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"workSheets\":[{\"name\":\"College\",\"datasetName\":\"College\"}],\"reportViewPath\":\"Regional_16578700410810/College\",\"filters\":[],\"parameters\":[],\"marks\":[{\"sheetName\":\"College\",\"markPairs\":[{\"AVG(Math)\":636.0,\"AVG(Verbal)\":564.0,\"AVG(Writing)\":600.0,\"Total Score\":1800.0,\"College\":\"Arts \\u0026 Sciences\",\"SUM(1)\":221.0,\"SUM(True Average)\":1611.7016105588443}]}],\"viewType\":\"worksheet\",\"viewTitle\":\"Workbook: Regional\",\"componentId\":15,\"componentName\":\"Tableau 15\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Tableau\",\"rank\":0,\"dataSourceName\":\"tabluea2\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.BIComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"workSheets\":[{\"name\":\"S\\u0026P Forward Returns\",\"datasetName\":\"S_P_Forward_Returns_222\"},{\"name\":\"S\\u0026P Returns by Decade\",\"datasetName\":\"S_P_Returns_by_Decade\"},{\"name\":\"S\\u0026P Returns Vs Conditions\",\"datasetName\":\"S_P_Returns_Vs_Conditions\"}],\"reportViewPath\":\"Regional-5/Economy\",\"filters\":[{\"name\":\"YEAR(Date)\",\"type\":\"quantitative\",\"min\":\"2001\",\"max\":\"2008\",\"workSheets\":[\"S\\u0026P Returns by Decade\"]}],\"parameters\":[],\"marks\":[{\"sheetName\":\"S\\u0026P Forward Returns\",\"markPairs\":[{\"Decade\":1970.0,\"Metric\":\"1 Year\",\"Value\":-0.280645944,\"YEAR(Date)\":1973.0},{\"Decade\":1930.0,\"Metric\":\"1 Year\",\"Value\":-0.342848002,\"YEAR(Date)\":1931.0}]}],\"viewType\":\"dashboard\",\"viewTitle\":\"Workbook: Regional-5\",\"componentId\":16,\"componentName\":\"Tableau 16\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Tableau\",\"rank\":0,\"dataSourceName\":\"tabluea2\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.BIComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"from py4j.java_gateway import java_import\\njava_import(spark._sc._jvm, \\\"org.apache.spark.sql.api.python.*\\\")\\n\\nfrom collections import defaultdict\\n\\nimport re\\nd\\u003d [(\\\"aa\\\",34, 44), (\\\"bb\\\",22,33),(\\\"cc\\\",45,44)]\\n\\ndf \\u003d spark.createDataFrame(d, [\\\"name\\\", \\\"marks-\\\", \\\"marks_\\\"])\\n\\ndf.show()\\n\\n\\ncolumn_map1 \\u003d defaultdict(list)\\ncolumn_map2 \\u003d {}\\nfor column in df.columns:\\n    m_column\\u003dre.sub(\\u0027[^0-9A-Za-z_]\\u0027, \\u0027_\\u0027, column)\\n    column_map1[m_column].append(column)\\n    column_map2[column] \\u003d m_column\\nprint(column_map1)\\nprint(column_map2)\\n\\nfor n_column, o_columns in column_map1.items():\\n    print(n_column)\\n    print(o_columns)\\n    if len(o_columns)\\u003e1:\\n        for num, o_col in enumerate(o_columns):\\n            if num\\u003e0:\\n                column_map2[o_col]\\u003df\\\"{n_column}_{num}\\\"\\nprint(column_map2)\\ndf \\u003d df.toDF(*[column_map2[c] for c in df.columns])\\n\\ndf.show()\\nprint(\\\"done\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":17,\"componentName\":\"Code 17\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"visuals\":[{\"id\":\"VisualContainer5\",\"name\":\"Total Revenue by Product\",\"datasetName\":\"Total_Revenue_by_Product\"}],\"slicers\":\"\",\"bookmark\":\"H4sIAAAAAAAAA9VaXXPiNhT9Kx53tnlxd7AhIcnbAkmaacikwNLudJiOsC+gjW15ZJmFZvjvvbJxgsE23vAV85JIsuRzzv2QdOFFtajv2WT+SBxQr9UGY88O4c+Krmqqm+zTrcrQqtZ0Q7fq9apZP69cAT7FPEGZ66vXL6ogfAyiT/2A2HJB7PxnoKnEtp/IWLZGxPZBUz3gPnOJTf+D6OF4aKGpMPNsxolcsyuIALnuFJ/HNmLRP1fwlcQUdApdMEXU2wGPcRG3NdWP/gsxJcewY0RtgevJf4fzm5nHEeRLzPU2HMQlxNyT7SYiGDNOTWJjZzRVzuzHiAxNveXMCddYakjxyRtXUDHHxr1rBb7gc+zrhUtWFqjIXxPgEM5pMteiMbRHJuQfCQp8f9l57yb7/OU8O3Dczae7LOAmdGD01gghLVDaJ85Q+QhWC3sQSJ/YQWgmXPKBIjnkKenJbin3Q/hY+qCRN1jNG6zlDZ7nDV7kDeq5iPTct+r13NHL3NGrXJnyRczFbORiNnIxG7moqpGBBgv5GURxt+JGhdxr08nXvWy1f8J+NDlgPFnqta6pJjEnYLXesk/k19SSK/smrnFvRUgcj3Dqx7ji1h/UxfGKpj7ASOwRcivs6dDxJFw1KygW8qlk7vzyK87VSkHByKIwxlQX2CLA7FQSKtUsKoFgDpP7RFmY1DKYNAD3P9w/y8LjPIsHZUoPzElZeFxk8GhOwAkPBCXhoWdF+y11iWvSEjHJCpHfmYDysKhnsGjj5sipPA2XhcllFhOwKCkNi6scFhjnSgum1ITSWMXIOqC0qUvdcWloZKWtR+b+hkuNqCgNlay89UTMZzIuk1GyclcHzLlpl4lJVtR35e6Ot/LAFIyXhU016xjcg5mgNp4dB5JJosqh71bmsFbLHC1ZqSlS4tivdK8FDmtds29A+HYfqLyeKHa9AocCZGFIXH037GBk2WEXPF0TXFSWrWNK9Ofjqh4CV5pOf4oiMtUOAedmBmYQXRKTmEIn3w7qfLcY8lZjCN8uk06hMNpHUdBb5xwDKFIZPOuyKTnLKTCd3QWuC/wsrjLtGmBv4DIwr5tKvnAaVpdROUGouyz69pN9YWrHfctelqJlO5oWWUEVmEGHbCYr3cPvYAq5SJho1xbS5cz04vJRoqiNQCYbOlSky544bFYxfLGmeOcEawNAG4gvy04FEdySTV+4a39Kebf0g1wDE3y2OSFcJE0cf82AL/i+8n3CUsR58YArZLVBmksZe3PO6hGd86erwQVs5Nt4A+OFDPSauA6AO9VKtSNq+5NZ8IMouxV1qq7nH1nX42S0HhPEVjowBTdIy6tbrSs4gEO8Qua94yzwjmbdi63WPaSw/y417X1T5LfMgf8ecU3CrXVlGbeAN6LdoUV5/LUznv1ujsFBar0hdf2kUv+isJHSxAzKHPn+8um8QSBV5MvTi7yMuNJqvII/VeKrk0r8ztPliYWNUKfKqVeOuME2vq4jW/acYlt9TZxlu6rYaLemjakIOFiRAZrMGbLU68sRvWxVUFk82PfNKcN7Ug8W+jEv4u+46xziPh79Um7DKGM56cRBpvQJVz4pgimNwBrD6c7S6SF3+oSz/YZmEoG+/EFiPMWeh4j4IpdxTf07XPmg5KJfyOHnfy0VB6ErKwAA\",\"pageName\":\"ReportSection\",\"reportId\":\"09ec02c8-4d75-40c0-a0fa-435d28363a48\",\"embedUrl\":\"https://app.powerbi.com/reportEmbed?reportId\\u003d09ec02c8-4d75-40c0-a0fa-435d28363a48\\u0026groupId\\u003d4c05b342-7214-4b21-b5b7-e159113b18b5\\u0026w\\u003d2\\u0026config\\u003deyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly9XQUJJLUlORElBLUNFTlRSQUwtQS1QUklNQVJZLXJlZGlyZWN0LmFuYWx5c2lzLndpbmRvd3MubmV0IiwiZW1iZWRGZWF0dXJlcyI6eyJtb2Rlcm5FbWJlZCI6dHJ1ZSwidXNhZ2VNZXRyaWNzVk5leHQiOnRydWV9fQ%3d%3d\",\"reportName\":\"Industry Margin Analysis\",\"componentId\":19,\"componentName\":\"Power BI 19\",\"tableName\":\"\",\"category\":\"Source\",\"componentType\":\"Power BI\",\"rank\":0,\"dataSourceName\":\"Power BI\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.PowerBiComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"from datagaps_utilities import config\\n\\nprint(config.app_version)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":20,\"componentName\":\"Code 20\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":20,"livyOptions":"{\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0,\"kind\":\"spark\"}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":null,"folderPath":"Dataflow/upendar","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}