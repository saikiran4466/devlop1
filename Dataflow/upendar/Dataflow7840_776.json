{"dataflow":{"dfKey":"78a1f9aa-ae97-4947-8ab8-f62f828f3559","name":"Dataflow7840_776","tags":null,"description":null,"definition":"{\"name\":\"Dataflow7840_776\",\"version\":0,\"livyServerId\":0,\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"excludeNotification\":\"N\"},{\"code\":\"import json\\nimport pandas as pd\\nfrom datetime import datetime\\nd \\u003d [\\n    {\\\"id\\\":10,\\\"c1\\\":\\\"ghg\\\", \\\"c2\\\": 23, \\\"c3\\\":3.8, \\\"c4\\\":{\\\"k\\\":{\\\"a\\\":2,\\\"b\\\":3}}, \\\"c5\\\":datetime.now()},\\n    {\\\"id\\\":11,\\\"c1\\\":\\\"ffg\\\", \\\"c2\\\": 65, \\\"c3\\\":5.89},\\n    {\\\"id\\\":12,\\\"c1\\\":\\\"yty\\\", \\\"c2\\\": 33, \\\"c3\\\":6.8},\\n    {\\\"id\\\":13,\\\"c1\\\":\\\"rtre\\\", \\\"c2\\\": 22, \\\"c3\\\":5.78},\\n    {\\\"id\\\":14,\\\"c1\\\":\\\"ryr\\\", \\\"c2\\\": 45, \\\"c3\\\":2.70},\\n    ]\\nfsdf \\u003d spark.createDataFrame(d)\\n\\nfsdf.show(5)\\nfsdf.createOrReplaceTempView(\\\"table_1\\\")\\n\\n# print([json.loads(i.json()) for i in fsdf.schema.fields])\\n\\n# jd \\u003d fsdf.toJSON().collect()\\n# jd \\u003d [json.loads(i) for i in jd]\\n# print(jd)\\n# fsdf2 \\u003d spark.createDataFrame(jd)\\n\\n# fsdf2.show(5)\\n# print([json.loads(i.json()) for i in fsdf2.schema.fields])\\n# df \\u003d fsdf.toPandas()\\n# jd \\u003d df.to_dict(orient\\u003d\\\"records\\\")\\n\\n# df2 \\u003d pd.DataFrame(jd)\\n# fsdf3 \\u003d spark.createDataFrame(df2)\\n\\n# fsdf3.show(5)\\n# print([json.loads(i.json()) for i in fsdf3.schema.fields])\\n\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":1,\"componentName\":\"Code 1\",\"tableName\":\"table_1\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"\\nfrom datagaps_utilities import json_to_rdb\\ninput_json \\u003d [\\n    {\\\"c1\\\":\\\"ghg\\\", \\\"c2\\\": 23, \\\"c3\\\":3.8, \\\"c4\\\":{\\\"k\\\":{\\\"a\\\":2,\\\"b\\\":3}}},\\n    {\\\"c1\\\":\\\"ffg\\\", \\\"c2\\\": 65, \\\"c3\\\":5.89},\\n    {\\\"c1\\\":\\\"yty\\\", \\\"c2\\\": 33, \\\"c3\\\":6.8},\\n    {\\\"c1\\\":\\\"rtre\\\", \\\"c2\\\": 22, \\\"c3\\\":5.78},\\n    {\\\"c1\\\":\\\"ryr\\\", \\\"c2\\\": 45, \\\"c3\\\":2.70},\\n    ]\\njson_to_rdb(session_object\\u003dspark ,data\\u003dinput_json,primary_table_name\\u003d\\\"a1\\\",use_short_names\\u003dFalse,parse_all_strings\\u003dFalse)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":4,\"componentName\":\"Code 4\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"\\nfrom datagaps_utilities import dataset_to_rdb\\ndataset_to_rdb(spark, \\\"table_1\\\",primary_table_name\\u003d\\\"a2\\\", use_short_names\\u003dFalse)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":5,\"componentName\":\"Code 5\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"import json\\nfrom datetime import datetime\\nd \\u003d [\\n    {\\\"c1\\\":\\\"ghg\\\", \\\"c2\\\": 23, \\\"c3\\\":3.8, \\\"c4\\\":[{\\\"k\\\":{\\\"b\\\":[8], \\\"a\\\":2}}], \\\"c5\\\":datetime.now()},\\n    {\\\"c1\\\":\\\"ffg\\\", \\\"c2\\\": 65, \\\"c3\\\":5.89},\\n    {\\\"c1\\\":\\\"yty\\\", \\\"c2\\\": 33, \\\"c3\\\":6.8},\\n    {\\\"c1\\\":\\\"rtre\\\", \\\"c2\\\": 22, \\\"c3\\\":5.78},\\n    {\\\"c1\\\":\\\"ryr\\\", \\\"c2\\\": 45, \\\"c3\\\":2.70},\\n    ]\\nfsdf \\u003d spark.createDataFrame(d)\\njd \\u003d fsdf.toJSON().collect()\\nprint(jd)\\njd \\u003d [json.loads(i) for i in jd]\\nprint(jd)\\nfsdf.show(5)\\n\\ndf \\u003d fsdf.toPandas()\\nprint(df)\\nprint(df.to_dict(orient\\u003d\\\"records\\\"))\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":6,\"componentName\":\"Code 6\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"format\":\"json\",\"enableSchema\":\"N\",\"schema\":[],\"fileMetadata\":[],\"enableTrim\":\"N\",\"componentId\":7,\"componentName\":\"File 7\",\"tableName\":\"sample_json\",\"category\":\"Source\",\"componentType\":\"File\",\"rank\":0,\"dataSourceName\":\"JSON_upendar\",\"displayRows\":50,\"dependencies\":[],\"options\":{\"mode\":\"PERMISSIVE\",\"dateFormat\":\"yyyy-MM-dd\",\"multiLine\":\"true\",\"timestampFormat\":\"yyyy-MM-dd \\u0027T\\u0027 HH:mm:ss.SSSXXX\",\"path\":\"sample2.json\",\"inferSchema\":\"true\"},\"className\":\"com.datagaps.dataflow.models.FileComponent\",\"isCheckpointEnabled\":\"N\",\"excludeNotification\":\"N\"},{\"code\":\"from datagaps_utilities import get_meta_data\\r\\nfrom datagaps_utilities.inner_functions import split_as_relational_data\\r\\ndataset_name \\u003d \\\"table_1\\\"\\r\\nsession_object \\u003d spark\\r\\nsdf \\u003d session_object.sql(f\\\"select * from {dataset_name}\\\")\\r\\n\\r\\ndf \\u003d sdf.toPandas()\\r\\njd \\u003d df.to_dict(orient\\u003d\\\"records\\\")\\r\\nprint(jd)\\r\\nrelational_data \\u003d split_as_relational_data(input_json\\u003djd, primary_table_name\\u003ddataset_name, use_short_names\\u003dFalse,\\r\\n                                           parse_all_strings\\u003dTrue)\\r\\n\\r\\nfinal_dict \\u003d relational_data[\\\"final_dict\\\"]\\r\\nshort_names \\u003d relational_data[\\\"short_names\\\"]\\r\\nprint(final_dict)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":8,\"componentName\":\"Code 8\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"from pandas import NaT, Timestamp\\n\\na\\u003d[{\\u0027id\\u0027: 1, \\u0027c1\\u0027: \\u0027ghg\\u0027, \\u0027c2\\u0027: 23, \\u0027c3\\u0027: 3.8, \\u0027c5\\u0027: Timestamp(\\u00272022-08-22 16:18:19.653026\\u0027)}]\\n\\nfsdf \\u003d spark.createDataFrame(a)\\n\\nfsdf.show(5)\\n\\njd \\u003d fsdf.toJSON().collect()\\njd \\u003d [json.loads(i) for i in jd]\\nprint(jd)\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":9,\"componentName\":\"Code 9\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"import pandas as pd\\r\\n\\r\\ndf \\u003d pd.read_excel(\\\"/home/datagaps/upendar/excel_files/dataflow5240.xlsx\\\", sheet_name\\u003d\\\"Data_Compare_3_Matched\\\", engine\\u003d\\\"openpyxl\\\")\\r\\n\\r\\nprint(df)\\r\\n\\r\\nsdf \\u003d spark.createDataFrame(df)\\r\\nsdf.show(5)\\r\\nsdf.createOrReplaceTempView(\\\"dataset_name\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":10,\"componentName\":\"Code 10\",\"tableName\":\"dataset_name\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"import pandas as pd\\r\\nimport traceback\\r\\nimport re\\r\\ndf_dict \\u003d pd.read_excel(\\\"/home/datagaps/upendar/excel_files/dataflow5240.xlsx\\\", sheet_name\\u003dNone, engine\\u003d\\\"openpyxl\\\")\\r\\n\\r\\n\\r\\n\\r\\nfor sheet_name, dataframe in df_dict.items():\\r\\n    try:\\r\\n        spark_dataframe \\u003d spark.createDataFrame(dataframe)\\r\\n        sheet_name \\u003d re.sub(\\\"[-,$@\\u0026|.: ]\\\", \\\"_\\\", sheet_name)\\r\\n        spark_dataframe.createOrReplaceTempView(sheet_name)\\r\\n        print(sheet_name)\\r\\n        spark_dataframe.show()\\r\\n    except:\\r\\n        print(traceback.format_exc())\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":11,\"componentName\":\"Code 11\",\"tableName\":\"Data_Compare_3_OnlyTarget\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"from datagaps_utilities import get_meta_data\\nget_meta_data(session_object\\u003dspark,dataset_name\\u003d\\\"table_1\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":2,\"componentName\":\"Code 2\",\"tableName\":\"meta_data_of_table_1\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[1],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"partitionOptions\":{\"partitionType\":\"\",\"name\":\"\"},\"componentId\":3,\"componentName\":\"SQL 3\",\"tableName\":\"SQL_3\",\"category\":\"Processor\",\"componentType\":\"SQL\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[2,1],\"options\":{\"dbTable\":\"select * from Data_Compare_3_OnlyTarget\"},\"className\":\"com.datagaps.dataflow.models.SQLComponent\",\"isCheckpointEnabled\":\"N\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":11,"livyOptions":"{\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0,\"kind\":\"spark\"}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":null,"folderPath":"Dataflow/upendar","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}