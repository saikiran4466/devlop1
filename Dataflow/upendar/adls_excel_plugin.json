{"dataflow":{"dfKey":"9281d1a3-3cbc-46d8-9e38-ec0e8880931e","name":"adls_excel_plugin","tags":null,"description":"","definition":"{\"name\":\"adls_excel_plugin\",\"description\":\"\",\"version\":0,\"livyServerId\":0,\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"code\":\"from py4j.java_gateway import java_import\\r\\njava_import(spark._sc._jvm, \\\"org.apache.spark.sql.api.python.*\\\")\\r\\n\\r\\nimport pandas as pd\\r\\nfrom azure.storage.filedatalake import DataLakeServiceClient\\r\\nimport re\\r\\n\\r\\n# java_object \\u003d spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getConnectionParams(\\\"EXCEL_upendar_adls\\\",\\\"read\\\")\\r\\n\\r\\n# data_source_details_list \\u003d [java_object.toList().apply(i) for i in range(java_object.size())]\\r\\n# data_source_details\\u003d {i._1(): i._2() for i in data_source_details_list}\\r\\n\\r\\n\\r\\nstorage_account_name \\u003d \\\"gen2adlsnewabfss\\\"\\r\\nstorage_account_key \\u003d \\\"G9x6IcPuRlsbpuY3FeL+IXKwGx05bo5TEwWrLoV4pLSGMzXXLB7iBpY1eQMK8G1NACrK+JltcVsXDmAVBIIGjg\\u003d\\u003d\\\"\\r\\nfile_system_name \\u003d \\\"container1\\\"\\r\\nfile_full_path \\u003d \\\"test folder 010323/sample1 (1).xls\\\"\\r\\n\\r\\n# storage_account_name \\u003d data_source_details[\\\"storage-account\\\"]\\r\\n# storage_account_key \\u003d spark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getDecryptedPassword(data_source_details[\\\"access-key\\\"])\\r\\n# file_system_name \\u003d data_source_details[\\\"container\\\"]\\r\\n# file_full_path \\u003d data_source_details[\\\"path\\\"] + \\\"sample1.xls\\\"\\r\\nprint(storage_account_name)\\r\\nprint(storage_account_key)\\r\\nprint(file_system_name)\\r\\nprint(file_full_path)\\r\\nprint(data_source_details)\\r\\n\\r\\ntry:\\r\\n    service_client \\u003d DataLakeServiceClient(account_url\\u003d\\\"{}://{}.dfs.core.windows.net\\\".format(\\r\\n        \\\"https\\\", storage_account_name), credential\\u003dstorage_account_key)\\r\\nexcept Exception as e:\\r\\n    print(e)\\r\\n\\r\\n\\r\\ndef read_file_from_directory(file_path):\\r\\n    try:\\r\\n        file_system_client \\u003d service_client.get_file_system_client(file_system\\u003dfile_system_name)\\r\\n\\r\\n        file_client \\u003d file_system_client.get_file_client(file_path)\\r\\n        download \\u003d file_client.download_file()\\r\\n        downloaded_bytes \\u003d download.readall()\\r\\n        return downloaded_bytes\\r\\n    except Exception as ex:\\r\\n        print(ex)\\r\\n\\r\\n\\r\\ndownloaded_file \\u003d read_file_from_directory(file_full_path)\\r\\n\\r\\ndf_dict \\u003d pd.read_excel(downloaded_file, sheet_name\\u003dNone, header\\u003dNone)\\r\\n# print(df)\\r\\nfor sheet_name, dataframe in df_dict.items():\\r\\n    spark_dataframe \\u003d spark.createDataFrame(dataframe.astype(\\u0027str\\u0027))\\r\\n    sheet_name \\u003d re.sub(\\\"[^0-9A-Za-z_]\\\", \\\"_\\\", sheet_name)\\r\\n    spark_dataframe.createOrReplaceTempView(sheet_name)\\r\\n    spark_dataframe.show()\\r\\n\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":1,\"componentName\":\"Code 1\",\"tableName\":\"code_1\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"pluginId\":\"2e3df604-d6f4-4b50-bf84-21a8187f58d5\",\"pluginName\":\"ADLS excel read multiple sheets upendar\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"0eb9055c-baa4-4a30-8184-a34dccfef01b\",\"fieldName\":\"file_name\",\"displayName\":\"File Name\",\"value\":\"sample1.xls\",\"dataType\":\"String\"},{\"parameterId\":\"087037a3-3beb-4664-8b03-fb5b8cf5733d\",\"fieldName\":\"component_name\",\"displayName\":\"Component Name\",\"value\":\"Plugin 2\",\"dataType\":\"String\"}],\"inputDatasets\":[],\"outputDatasets\":[],\"dataSources\":[{\"paramId\":\"69d29094-0bf9-4a3b-8585-6550a5c65da5\",\"fieldName\":\"data_source\",\"displayName\":\"Select Excel Data Source\",\"value\":\"1917\"}]},\"componentId\":2,\"componentName\":\"Plugin 2\",\"tableName\":\"Plugin_2\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"pluginId\":\"ee826cc3-51d5-4fd7-96ad-e0f5080c1ad5\",\"pluginName\":\"ADLS excel read single sheet\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"f5e24678-4e04-4d75-84a0-30cfe17a988d\",\"fieldName\":\"sheet_name\",\"displayName\":\"Sheet Name\",\"value\":\"Example Test\",\"dataType\":\"String\"},{\"parameterId\":\"0eb9055c-baa4-4a30-8184-a34dccfef01b\",\"fieldName\":\"file_name\",\"displayName\":\"File Name\",\"value\":\"sample1.xls\",\"dataType\":\"String\"}],\"inputDatasets\":[],\"outputDatasets\":[{\"outputDatasetId\":\"c1809fda-5dda-4af7-807c-a1cd2efe6d5a\",\"fieldName\":\"output_dataset_name\",\"displayName\":\"Output Dataset Name\",\"value\":\"out_dataet123\"}],\"dataSources\":[{\"paramId\":\"f3aaa13b-65a2-4a22-8d1f-e26227bd2def\",\"fieldName\":\"data_source\",\"displayName\":\"Select Excel Data Source\",\"value\":\"1917\"}]},\"componentId\":3,\"componentName\":\"Plugin 3\",\"tableName\":\"Plugin_3\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"pluginId\":\"ed8476c8-dae6-4863-a0e6-ff76506bd6fc\",\"pluginName\":\"ADLS excel read single and multiple sheets\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"0eb9055c-baa4-4a30-8184-a34dccfef01b\",\"fieldName\":\"file_name\",\"displayName\":\"File Name\",\"value\":\"sample1.xls\",\"dataType\":\"String\"},{\"parameterId\":\"087037a3-3beb-4664-8b03-fb5b8cf5733d\",\"fieldName\":\"component_name\",\"displayName\":\"Component Name\",\"value\":\"Plugin 2\",\"dataType\":\"String\"},{\"parameterId\":\"c7e358d4-77d5-4941-b1ea-c63eada34ad7\",\"fieldName\":\"sheet_names\",\"displayName\":\"Sheet names\",\"value\":\"[\\\"Readme\\\"]\",\"dataType\":\"text\"}],\"inputDatasets\":[],\"outputDatasets\":[],\"dataSources\":[{\"paramId\":\"69d29094-0bf9-4a3b-8585-6550a5c65da5\",\"fieldName\":\"data_source\",\"displayName\":\"Select Excel Data Source\",\"value\":\"1917\"}]},\"componentId\":5,\"componentName\":\"Plugin 5\",\"tableName\":\"Plugin_5\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"sourceDataFrame\":\"Example_Test\",\"componentId\":4,\"componentName\":\"Data Rule 4\",\"tableName\":\"\",\"category\":\"Data Quality\",\"componentType\":\"Data Rule\",\"rank\":0,\"displayRows\":50,\"dependencies\":[3],\"className\":\"com.datagaps.dataflow.models.DataRuleComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":5,"livyOptions":"{\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0,\"kind\":\"spark\"}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":"","folderPath":"Dataflow/upendar","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}