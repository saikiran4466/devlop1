{"dataflow":{"dfKey":"c771b80c-5070-4536-8147-f54fb9db354f","name":"Dataflow_500_json_flatten_upendar","tags":null,"description":"","definition":"{\"name\":\"Dataflow_500_json_flatten_upendar\",\"description\":\"\",\"version\":0,\"livyServerId\":0,\"engineVariableName\":\"test_cluster2\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"excludeNotification\":\"N\"},{\"format\":\"json\",\"enableSchema\":\"N\",\"schema\":[],\"fileMetadata\":[],\"enableTrim\":\"N\",\"componentId\":2,\"componentName\":\"File 2\",\"tableName\":\"File_2\",\"category\":\"Source\",\"componentType\":\"File\",\"rank\":0,\"dataSourceName\":\"JSON_upendar\",\"displayRows\":50,\"dependencies\":[],\"options\":{\"mode\":\"PERMISSIVE\",\"dateFormat\":\"yyyy-MM-dd\",\"multiLine\":\"true\",\"timestampFormat\":\"yyyy-MM-dd \\u0027T\\u0027 HH:mm:ss.SSSXXX\",\"path\":\"sample1.json\",\"inferSchema\":\"true\"},\"className\":\"com.datagaps.dataflow.models.FileComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"import json\\r\\nimport copy\\r\\nfile_path \\u003d \\\"/home/datagaps/upendar/json_files/sample1.json\\\"\\r\\ndataframe_name \\u003d \\u0027flatten_json\\u0027\\r\\ndef flatten(d, parent\\u003dNone):\\r\\n    fd \\u003d {}\\r\\n    for k, v in d.items():\\r\\n        if parent:\\r\\n            pre_fix \\u003d parent + \\\".\\\" + k\\r\\n        else:\\r\\n            pre_fix \\u003d k\\r\\n        if isinstance(v, dict):\\r\\n            fd.update(flatten(v, pre_fix))\\r\\n        else:\\r\\n            fd[pre_fix] \\u003d v\\r\\n    return fd\\r\\ndef unwind(d):\\r\\n    recheck \\u003d False\\r\\n    l \\u003d []\\r\\n    for k, v in d.items():\\r\\n        if isinstance(v, list):\\r\\n            if v:\\r\\n                l.extend([{**copy.deepcopy(d), k: _} for _ in v])\\r\\n            else:\\r\\n                l.append({**copy.deepcopy(d), k: v})\\r\\n            recheck \\u003d True\\r\\n            break\\r\\n    else:\\r\\n        return [d]\\r\\n    if recheck:\\r\\n        if len(l) \\u003e 1:\\r\\n            for i in range(len(l)):\\r\\n                l.extend(unwind(l.pop(0)))\\r\\n    return l\\r\\ndef final_1(dorl):\\r\\n    if isinstance(dorl, dict):\\r\\n        s \\u003d flatten(dorl)\\r\\n        res_unwind \\u003d unwind(s)\\r\\n        if res_unwind \\u003d\\u003d [dorl]:\\r\\n            return res_unwind\\r\\n        else:\\r\\n            res_unwind \\u003d final_1(res_unwind)\\r\\n    else:\\r\\n        res_unwind \\u003d []\\r\\n        for dl in dorl:\\r\\n            res_unwind.extend(final_1(dl))\\r\\n    return res_unwind\\r\\nwith open(file_path) as f:\\r\\n    json_list \\u003d json.loads(f.read())\\r\\nfinal_res \\u003d final_1(json_list)\\r\\nfinal_df \\u003d spark.createDataFrame(final_res)\\r\\nfinal_df.createOrReplaceTempView(dataframe_name)\\r\\nfinal_df.show()\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":3,\"componentName\":\"Code 3\",\"tableName\":\"flatten_json\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":3,"livyOptions":"{\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0,\"kind\":\"spark\"}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":"Default","folderPath":"Dataflow/upendar","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}