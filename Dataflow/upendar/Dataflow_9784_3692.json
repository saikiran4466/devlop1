{"dataflow":{"dfKey":"20e343e9-a990-4e01-b4f9-4a339b5a6a7a","name":"Dataflow_9784_3692","tags":null,"description":"","definition":"{\"name\":\"Dataflow_9784_3692\",\"description\":\"\",\"version\":0,\"livyServerId\":0,\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"excludeNotification\":\"N\"},{\"code\":\"import requests\\r\\nfrom pyspark.sql import functions as F\\r\\nfrom datagaps_utilities import dataset_to_rdb\\r\\nimport json\\r\\n\\r\\n \\r\\n\\r\\ndf\\u003dspark.sql(\\\"select * from $[input_dataset]\\\")\\r\\n#df.show()\\r\\npdf \\u003d df.toPandas().to_dict(orient\\u003d\\\"records\\\")\\r\\n#print(pdf)\\r\\ndef api_get_call(i):\\r\\n    url \\u003d \\\"$[url]\\\"\\r\\n    params \\u003d {\\u0027fundCode\\u0027: i[\\u0027fundCode\\u0027], \\u0027sodDate\\u0027: \\u0027$[sodDate]\\u0027}\\r\\n    #json.dumps(i)\\r\\n    headers \\u003d {\\u0027Content-Type\\u0027: \\u0027application/json\\u0027}\\r\\n    response \\u003d requests.get(url, headers\\u003dheaders, params\\u003dparams)\\r\\n    output_json\\u003dresponse.json()\\r\\n    #print(output_json)    \\r\\n    if response.status_code \\u003d\\u003d 200:\\r\\n        return{\\\"output_json\\\":output_json}\\r\\n    else:\\r\\n        print(\\\"given error for api params\\\", params)\\r\\n    #return{\\\"input_json\\\":i,\\\"response_time\\\":response_time,\\\"output_json\\\":output_json,\\\"response_code\\\":response_code}\\r\\n\\r\\n \\r\\n\\r\\nl\\u003d[]\\r\\nfor i in pdf:\\r\\n    l.extend(api_get_call(i))\\r\\n\\r\\n \\r\\n\\r\\ndf2\\u003dspark.createDataFrame(l)\\r\\ndf2.show()\\r\\ndf2.createOrReplaceTempView(\\\"$[output_dataset]\\\")\\r\\n#dataset_to_rdb(spark, \\\"post_output2\\\", primary_table_name\\u003d\\\"api_post_2\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":1,\"componentName\":\"Code 1\",\"tableName\":\"table_2\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"},{\"code\":\"from py4j.java_gateway import java_import\\r\\njava_import(spark._sc._jvm, \\\"org.apache.spark.sql.api.python.*\\\")\\r\\nimport requests\\r\\nfrom pyspark.sql import functions as F\\r\\nfrom datagaps_utilities import dataset_to_rdb\\r\\nimport json\\r\\nimport re\\r\\n \\r\\n\\r\\nl1\\u003d[\\r\\n\\t{\\\"name\\\":\\\"upendar\\\",\\r\\n\\t\\\"marks\\\":80},\\r\\n\\t{\\\"name\\\":\\\"uk1\\\",\\r\\n\\t\\\"marks\\\":89}\\r\\n]\\r\\n\\r\\n\\r\\nl2\\u003d[\\r\\n\\t{\\\"name\\\":\\\"upendar3\\\",\\r\\n\\t\\\"age\\\":33},\\r\\n\\t{\\\"name\\\":\\\"uk3\\\",\\r\\n\\t\\\"age\\\":23}\\r\\n]\\r\\n\\r\\nprint(\\\"\\\\napi1 res:\\\")\\r\\nprint(l1)\\r\\nprint(\\\"api2 res:\\\")\\r\\nprint(l2)\\r\\nl\\u003d[]\\r\\nl.extend(l1)\\r\\nl.extend(l2)\\r\\n\\r\\n \\r\\nprint(\\\"\\\\nresult:\\\")\\r\\nrdd \\u003d spark.sparkContext.parallelize(l)\\r\\nsdf \\u003d spark.read.json(rdd.map(lambda x: json.dumps(x)))\\r\\nsdf \\u003d sdf.toDF(*[re.sub(\\u0027[^0-9A-Za-z_]\\u0027, \\u0027_\\u0027, c) for c in sdf.columns])\\r\\nsdf.show()\\r\\nsdf.createOrReplaceTempView(\\\"table_3\\\")\\r\\n#dataset_to_rdb(spark, \\\"post_output2\\\", primary_table_name\\u003d\\\"api_post_2\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":2,\"componentName\":\"Code 2\",\"tableName\":\"table_3\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":2,"livyOptions":"{\"kind\":\"spark\",\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":"","folderPath":"Dataflow/upendar","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}