{"dataflow":{"dfKey":"0d3a9cf5-8110-499a-8400-5a619a096f0d","name":"Dataflow_7293","tags":null,"description":null,"definition":"{\"name\":\"Dataflow_7293\",\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"dbScripts\":[{\"script\":\"update mohan_mgp set age\\u003d66 where first_name\\u003d\\u0027sachin\\u0027\",\"executionOrder\":1,\"title\":\"\"},{\"script\":\"insert into mohan_mgp values(265,\\u0027virat\\u0027,\\u0027aa\\u0027)\",\"executionOrder\":2,\"title\":\"\"},{\"script\":\"select * from mohan_mgp where age\\u003e100\",\"executionOrder\":3,\"title\":\"\"}],\"componentId\":1,\"componentName\":\"DB Script 1\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"DB script\",\"rank\":0,\"dataSourceName\":\"Oracle_km\",\"displayRows\":50,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.DBScriptComponent\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"partitionOptions\":{\"partitionType\":\"\",\"name\":\"\"},\"enableTrim\":\"N\",\"easyQueryDefJson\":{\"sqlQuery\":\"\"},\"componentId\":2,\"componentName\":\"JDBC 2\",\"tableName\":\"stageDf\",\"category\":\"Source\",\"componentType\":\"JDBC\",\"rank\":0,\"dataSourceName\":\"Oracle_km\",\"displayRows\":50,\"dependencies\":[],\"options\":{\"dbTable\":\"select * from mohan_mgp where age\\u003e100\"},\"className\":\"com.datagaps.dataflow.models.JDBCComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"partitionOptions\":{\"partitionType\":\"\",\"name\":\"\"},\"enableTrim\":\"N\",\"easyQueryDefJson\":{\"sqlQuery\":\"\"},\"componentId\":3,\"componentName\":\"JDBC 3\",\"tableName\":\"oldWsDf\",\"category\":\"Source\",\"componentType\":\"JDBC\",\"rank\":0,\"dataSourceName\":\"PostgreSQL_WS__17_1626\",\"displayRows\":50,\"dependencies\":[],\"options\":{\"dbTable\":\"select * from t_a0f641c6_a0a5_4d88_8968_21e746742d7f\"},\"className\":\"com.datagaps.dataflow.models.JDBCComponent\",\"isCheckpointEnabled\":\"N\",\"dataSourceLogicalName\":\"\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"var oldWsDf\\u003dspark.sql(\\\"select * from oldWsDf\\\")\\nvar stageDf\\u003dspark.sql(\\\"select * from stageDf\\\")\\nval selectColumns \\u003d stageDf.columns.map(colName \\u003d\\u003e s\\\"`${colName}`\\\").mkString(\\\", \\\")\\n stageDf \\u003d spark.sql(s\\\"SELECT $selectColumns , md5(concat($selectColumns)) as checksum FROM stageDf\\\")\\n stageDf.withColumn(\\\"status\\\",lit(\\\"open\\\")).withColumn(\\\"identified_date\\\",current_date()).withColumn(\\\"identified_run_id\\\",lit(1122)).withColumn(\\\"actual_resolution_date\\\",lit(\\\"null\\\")).withColumn(\\\"resolution_run_id\\\",lit(0)).withColumn(\\\"expected_resolution_date\\\",lit(\\\"null\\\"))\\n\\nval result \\u003d oldWsDf.join(stageDf, Seq(\\\"checksum\\\"), \\\"left_anti\\\")\\nresult.show()\\n        var concatenatedResult \\u003d spark.emptyDataFrame\\n        \\n          // Update status column to \\u0027closed\\u0027\\n          val closedWorkSchema \\u003d result.withColumn(\\\"status\\\", lit(\\\"closed\\\")).withColumn(\\\"resolution_run_id\\\",lit(1126)).withColumn(\\\"actual_resolution_date\\\",lit(current_date()))\\n           // .orderBy(selectColumns,\\\"checksum\\\",\\\"status\\\",\\\"identified_date\\\",\\\"identified_run_id\\\",\\\"actual_resolution_date\\\",\\\"resolution_runId\\\",\\\"expected_resolution_date\\\")\\n          closedWorkSchema.show()\\n         val closedColumns\\u003d closedWorkSchema.columns\\n          val oldWorkSchemaColumns\\u003doldWsDf.columns\\n          val intersectColumns\\u003doldWorkSchemaColumns.intersect(closedColumns)\\n         val oldWorkSchemaDf\\u003d oldWsDf.select(intersectColumns.head,intersectColumns.tail: _*)\\n          val updatedStatusAsClosed\\u003dclosedWorkSchema.select(intersectColumns.head,intersectColumns.tail: _*)\\n           val finalResult \\u003d oldWorkSchemaDf.union(updatedStatusAsClosed)\\n\\n           //val finalResult \\u003d oldWSDf.union(closedWorkSchema)\\n          finalResult.show()\\n         val finalResultColumns\\u003d finalResult.columns\\n          val stageDfColumns\\u003dstageDf.columns\\n          stageDf.show\\n          val commonColumns\\u003dfinalResultColumns.intersect(stageDfColumns)\\n         val df2Ordered\\u003d finalResult.select(commonColumns.head,commonColumns.tail: _*)\\n          val stageDfOrdered\\u003dstageDf.select(commonColumns.head,commonColumns.tail: _*)\\n          // Concatenate the result with df2\\n          concatenatedResult \\u003d stageDfOrdered.union(df2Ordered)\\n          //stageDfOrdered.show\\n          concatenatedResult.show()\",\"kind\":\"spark\",\"dataSourceId\":0,\"componentId\":4,\"componentName\":\"Code 4\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[2,3],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":4,"livyOptions":"{\"kind\":\"spark\",\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"5G\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":"","folderPath":"Dataflow","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}