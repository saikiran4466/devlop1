{"dataflow":{"dfKey":"a691f48a-b936-4af9-8471-ef59806e608b","name":"Dataflow_9397","tags":null,"description":null,"definition":"{\"name\":\"Dataflow_9397\",\"version\":0,\"livyServerId\":0,\"engineVariableName\":\"\",\"components\":[{\"udfNames\":[],\"componentId\":0,\"componentName\":\"startComponent\",\"tableName\":\"\",\"category\":\"Start\",\"componentType\":\"UDF\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":0,\"dependencies\":[],\"className\":\"com.datagaps.dataflow.models.UDFComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"pluginId\":\"f70a7cb7-d8bc-4564-8bd0-628c5fb6760a\",\"pluginName\":\"Reading Excel file(single/multiple sheets) from local location(Engine)\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"a4dfd914-43ab-46f8-8af1-32c4990adcb0\",\"fieldName\":\"file_name\",\"displayName\":\"Enter File Name\",\"value\":\"Film_actor.xlsx\",\"dataType\":\"String\"},{\"parameterId\":\"9ef0ff87-1c6e-40ab-90cd-d6d448b90b78\",\"fieldName\":\"sheet_names\",\"displayName\":\"Enter Sheet Names\",\"value\":\"[\\\"Sheet1\\\"]\",\"dataType\":\"text\"},{\"parameterId\":\"4dc33a66-217d-4b10-9b4e-42ce1c875d80\",\"fieldName\":\"comp_name\",\"displayName\":\"Enter Component Name\",\"value\":\"Plugin 1\",\"dataType\":\"String\"}],\"inputDatasets\":[],\"outputDatasets\":[],\"dataSources\":[{\"paramId\":\"fe0736cc-8217-4242-a23e-441b78cae0e3\",\"fieldName\":\"data_source\",\"displayName\":\"Select Excel Data Source\",\"value\":\"2044\"}]},\"componentId\":1,\"componentName\":\"Plugin 1\",\"tableName\":\"Plugin_1\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"},{\"pluginId\":\"e4dc4130-a570-435d-ae5e-205d3edaf9f1\",\"pluginName\":\"Reading Excel files (single/multiple sheet) from shared Location\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"425229ea-b531-4da6-8e20-8852a7a4a695\",\"fieldName\":\"file_name\",\"displayName\":\"Enter File Name\",\"value\":\"Sample_excel.xlsx\",\"dataType\":\"String\"},{\"parameterId\":\"280cd50a-e74b-4c74-b95c-d39cd2d28299\",\"fieldName\":\"sheet_names\",\"displayName\":\"Enter Sheet Names\",\"value\":\"None\",\"dataType\":\"text\"},{\"parameterId\":\"f9ddd118-f19b-46c5-adb5-acb341b9710f\",\"fieldName\":\"comp_name\",\"displayName\":\"Enter the Component Name\",\"value\":\"Plugin 4\",\"dataType\":\"String\"}],\"inputDatasets\":[],\"outputDatasets\":[],\"dataSources\":[{\"paramId\":\"22adb3d3-68eb-4821-8018-489212e40073\",\"fieldName\":\"source_datasource\",\"displayName\":\"Select Data Source\",\"value\":\"1223\"}]},\"componentId\":4,\"componentName\":\"Plugin 4\",\"tableName\":\"Plugin_4\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"import re\\r\\nimport smbclient\\r\\nimport databricks.koalas as ks\\r\\nimport os\\r\\nimport json\\r\\n\\r\\nconn_map\\u003dspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getConnectionParams(\\\"EXCEL_shared\\\",\\\"read\\\")\\r\\nconn\\u003d[conn_map.toList().apply(i) for i in range(conn_map.size())]\\r\\nconn_details\\u003d {i._1(): i._2() for i in conn}\\r\\nshared_path\\u003dconn_details[\\\"path\\\"].split(\\\":\\\")[1]\\r\\nfile_path\\u003dos.path.join(shared_path,\\\"Sample_excel.xlsx\\\")\\r\\nheader \\u003d 0 if conn_details.get(\\\"useHeader\\\")\\u003d\\u003d\\\"true\\\" else None\\r\\nsheet_names \\u003d None\\r\\n\\r\\nprint(header)\\r\\nif sheet_names is None or type(sheet_names) \\u003d\\u003d list:\\r\\n\\tif type(sheet_names) \\u003d\\u003d list:\\r\\n\\t\\tif len(sheet_names)\\u003d\\u003d0:\\r\\n\\t\\t\\traise Exception(\\\"sheet names should not be empty list\\\")\\r\\nelse:\\r\\n\\traise Exception(\\\"sheet names should be list or None\\\")\\r\\n\\r\\nif conn_details[\\\"impersonate\\\"]\\u003d\\u003d\\\"false\\\":\\r\\n\\tsmbclient.ClientConfig()\\r\\nelse:\\r\\n\\tusername\\u003dconn_details[\\\"userName\\\"]\\r\\n\\tpassword\\u003dspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getDecryptedPassword(conn_details[\\\"password\\\"])\\r\\n\\tsmbclient.ClientConfig(username\\u003dusername, password\\u003dpassword)\\r\\n\\t\\r\\nls\\u003d[]\\r\\nwith smbclient.open_file(file_path,mode\\u003d\\\"rb\\\") as fd:\\r\\n\\tdf1 \\u003d ks.read_excel(fd,engine\\u003d\\\"openpyxl\\\",sheet_name\\u003dsheet_names,dtype\\u003dstr,header\\u003dNone)\\r\\n\\tfor i in df1.keys():\\r\\n\\t\\tk\\u003dre.sub(\\\"[^0-9A-Za-z_]\\\", \\\"_\\\", i)\\r\\n\\t\\tprint(k)\\r\\n\\t\\tdf1[i].columns\\u003ddf1[i].columns.astype(str).str.replace(\\\"[^0-9A-Za-z_]\\\",\\\"_\\\")\\r\\n\\t\\tdf1[i]\\u003ddf1[i].fillna(\\\"\\\")\\r\\n\\t\\tdf1[i]\\u003ddf1[i].to_spark()\\r\\n\\t\\tdf1[i].show(5)\\r\\n\\t\\tspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.saveDataset(df1[i]._jdf,k,\\\"Code 5\\\",22363)\\r\\n\\t\\tls.append(k)\\r\\n\\t\\tdf1[i].createOrReplaceTempView(k)\\r\\n \\r\\nspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.deleteDatasetInfo(json.dumps(ls),22363,\\\"Code 5\\\") \\r\\n \\r\\n \\r\\n\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":5,\"componentName\":\"Code 5\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"import re\\r\\nimport databricks.koalas as ks\\r\\nimport json\\r\\nimport os\\r\\nconn_map\\u003dspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.getConnectionParams(\\\"EXCEL_local_plugin\\\",\\\"read\\\")\\r\\nconn\\u003d[conn_map.toList().apply(i) for i in range(conn_map.size())]\\r\\nconn_details\\u003d {i._1(): i._2() for i in conn}\\r\\npath\\u003dconn_details[\\\"path\\\"]\\r\\nfilepath\\u003dos.path.join(path,\\\"Film_actor.xlsx\\\")\\r\\nheader \\u003d 0 if conn_details.get(\\\"useHeader\\\")\\u003d\\u003d\\\"true\\\" else None\\r\\n\\r\\nsheet_names \\u003d [\\\"Sheet1\\\",\\\"Sheet4\\\"]\\r\\nif sheet_names is None or type(sheet_names) \\u003d\\u003d list:\\r\\n\\tif type(sheet_names) \\u003d\\u003d list:\\r\\n\\t\\tif len(sheet_names)\\u003d\\u003d0:\\r\\n\\t\\t\\traise Exception(\\\"sheet names should not be empty list\\\")\\r\\nelse:\\r\\n\\traise Exception(\\\"sheet names should be list or None\\\")\\r\\n\\r\\ndf1 \\u003d ks.read_excel(filepath,engine\\u003d\\\"openpyxl\\\",sheet_name\\u003dsheet_names,dtype\\u003dstr,header\\u003dNone)\\r\\nls\\u003d[]\\r\\nfor i in df1.keys():\\r\\n\\tk\\u003dre.sub(\\\"[^0-9A-Za-z_]\\\", \\\"_\\\", i)\\r\\n\\tprint(k)\\r\\n\\tdf1[i].columns\\u003ddf1[i].columns.astype(str).str.replace(\\\"[^0-9A-Za-z_]\\\",\\\"_\\\")\\r\\n\\tdf1[i]\\u003ddf1[i].fillna(\\\"\\\")\\r\\n\\tdf1[i]\\u003ddf1[i].to_spark()\\r\\n\\tdf1[i].show(5)\\r\\n\\tspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.saveDataset(df1[i]._jdf,k,\\\"Code 6\\\",22363)\\r\\n\\tls.append(k)\\r\\n\\tdf1[i].createOrReplaceTempView(k)\\r\\n\\t\\r\\nspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.deleteDatasetInfo(json.dumps(ls),22363,\\\"Code 6\\\")\\t\\r\\n\\t\\r\\n\\t\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":6,\"componentName\":\"Code 6\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"import json\\nls\\u003d[\\\"Sheet3\\\"]\\nspark.sparkContext._jvm.com.datagaps.core.engine.utils.CodeUtils.deleteDatasetInfo(json.dumps(ls),22363,\\\"Plugin 1\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":8,\"componentName\":\"Code 8\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"code\":\"\\nfrom datagaps_utilities import send_email\\nto_mail\\u003d[\\\"ramesh.kovvuru@datagaps.com\\\"]\\nsend_email(session_object\\u003dspark,to\\u003dto_mail, subject\\u003d\\\"\\u003cEnter subject of mail…\\u003e\\\",content\\u003d\\\"\\u003cEnter mail content….\\u003e\\\", content_type\\u003d\\\"Plain\\\")\\n\\nfrom datagaps_utilities import send_email\\nsend_email(session_object\\u003dspark,to\\u003d\\\"\\u003cEnter mail id…\\u003e\\\",subject\\u003d\\\"\\u003cEnter subject of mail…\\u003e\\\",content\\u003d\\\"\\u003cEnter mail content….\\u003e\\\", content_type\\u003d\\\"Plain\\\")\",\"kind\":\"pyspark\",\"dataSourceId\":0,\"componentId\":10,\"componentName\":\"Code 10\",\"tableName\":\"\",\"category\":\"Processor\",\"componentType\":\"Code\",\"rank\":0,\"dataSourceName\":\"\",\"displayRows\":50,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.CodeComponent\",\"executionOption\":\"\",\"excludeNotification\":\"N\"},{\"pluginId\":\"0204ea2b-6357-47c6-a5a8-d7ea120cc28b\",\"pluginName\":\"Send an Email to open relay servers\",\"pluginOptions\":{\"parameters\":[{\"parameterId\":\"c9e7e253-413e-4844-a54f-98d53de29db6\",\"fieldName\":\"url_ip\",\"displayName\":\"Enter IP Address\",\"value\":\"192.168.6.137\",\"dataType\":\"String\"},{\"parameterId\":\"fe4cdaef-196d-4577-9df8-180c37b4774b\",\"fieldName\":\"port\",\"displayName\":\"Enter Port Value\",\"value\":\"25\",\"dataType\":\"Number\"},{\"parameterId\":\"df3cb001-83a0-4ebe-a567-eaa083a29ece\",\"fieldName\":\"sender\",\"displayName\":\"Enter Sender Email Address\",\"value\":\"anil@dgtest.net\",\"dataType\":\"String\"},{\"parameterId\":\"5244bbca-3c4a-4ca9-813d-958a74fe2ce3\",\"fieldName\":\"receiver\",\"displayName\":\"Enter Receiver Email Address\",\"value\":\"[\\\"anil@dgtest.net\\\",\\\"satish@dgtest.net\\\",\\\"anil@dgtest.net\\\"]\",\"dataType\":\"text\"},{\"parameterId\":\"ba0170d9-5185-46b7-9fcd-138ca5c42e50\",\"fieldName\":\"subject\",\"displayName\":\"Enter Mail Subject\",\"value\":\"multiple  email123\",\"dataType\":\"String\"},{\"parameterId\":\"e781294f-2fde-4e44-a788-599fe7d78ea1\",\"fieldName\":\"body_heading\",\"displayName\":\"Enter Mail Body Heading\",\"value\":\"multiple tests mail\",\"dataType\":\"text\"},{\"parameterId\":\"6b9d4712-6c63-4522-b5f3-9cd54ee63ea3\",\"fieldName\":\"body_message\",\"displayName\":\"Enter Message\",\"value\":\"example\",\"dataType\":\"text\"}],\"inputDatasets\":[],\"outputDatasets\":[],\"dataSources\":[]},\"componentId\":11,\"componentName\":\"Plugin 11\",\"tableName\":\"Plugin_11\",\"category\":\"Processor\",\"componentType\":\"Plugin\",\"rank\":0,\"displayRows\":0,\"dependencies\":[],\"options\":{},\"className\":\"com.datagaps.dataflow.models.PluginComponent\",\"executionOption\":\"allparentpassorfail\",\"excludeNotification\":\"N\"}],\"isDeleteWorkSchemaTable\":\"N\"}","parameters":"[{\"name\":\"limit_rows\",\"defValueInInteractiveMode\":\"limit 10\",\"defValueInBatchMode\":\"limit 1000\"}]","version":3,"maxComponentId":11,"livyOptions":"{\"proxyUser\":\"\",\"jars\":[],\"pyFiles\":[],\"files\":[],\"driverMemory\":\"\",\"driverCores\":0,\"executorMemory\":\"\",\"executorCores\":0,\"numExecutors\":0,\"archives\":[],\"queue\":\"\",\"name\":\"\",\"conf\":{},\"heartbeatTimeoutInSecond\":0,\"kind\":\"spark\"}","isDeleted":"N","userName":null,"type":"dataflow","environmentName":"","folderPath":"Dataflow","workSchemaName":null},"analysis":[],"datamodels":[],"tagDetails":[],"dataCompares":[]}